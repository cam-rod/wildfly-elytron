<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Elytron: Encrypting Pre-Existing Filesystem realms</title>
    <script src="/wildfly-elytron/assets/javascript/highlight.pack.js" type="text/javascript"></script>

    <link rel="shortcut icon" type="image/png" href="/wildfly-elytron/favicon.ico">
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:300,400,500,700" type="text/css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <!-- We override the colours from this theme manually -->
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
    <link rel="stylesheet" href="/wildfly-elytron/assets/css/styles.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
    <script src="/wildfly-elytron/assets/javascript/hl.js" type="text/javascript"></script>
    <link rel="alternate" type="application/rss+xml"  href="/wildfly-elytron/feed.xml" title="WildFly Elytron">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-135301155-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-135301155-1');
    </script>
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Encrypting Pre-Existing Filesystem realms | WildFly Elytron</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Encrypting Pre-Existing Filesystem realms" />
<meta name="author" content="Ashpan Raskar" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Overview" />
<meta property="og:description" content="Overview" />
<link rel="canonical" href="https://wildfly-security.github.io/wildfly-elytron/blog/filesystem-encryption-tool/" />
<meta property="og:url" content="https://wildfly-security.github.io/wildfly-elytron/blog/filesystem-encryption-tool/" />
<meta property="og:site_name" content="WildFly Elytron" />
<meta property="og:image" content="https://wildfly-security.github.io/wildfly-elytron/assets/images/wildfly-elytron-logo.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-04-19T00:00:00+00:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://wildfly-security.github.io/wildfly-elytron/assets/images/wildfly-elytron-logo.jpg" />
<meta property="twitter:title" content="Encrypting Pre-Existing Filesystem realms" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Ashpan Raskar"},"dateModified":"2022-04-19T00:00:00+00:00","datePublished":"2022-04-19T00:00:00+00:00","description":"Overview","headline":"Encrypting Pre-Existing Filesystem realms","image":"https://wildfly-security.github.io/wildfly-elytron/assets/images/wildfly-elytron-logo.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"https://wildfly-security.github.io/wildfly-elytron/blog/filesystem-encryption-tool/"},"url":"https://wildfly-security.github.io/wildfly-elytron/blog/filesystem-encryption-tool/"}</script>
<!-- End Jekyll SEO tag -->

</head>
<body>


<!-- Always shows a header, even in smaller screens. -->
<div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
    <header class="mdl-layout__header mdl-layout__header--scroll">
        <div class="mdl-layout__header-row ">
            <!-- Title -->
            <span class="mdl-layout-title"><h3>Wild<strong>Fly</strong>  Elytron</h3></span>
            <!-- Add spacer, to align navigation to the right -->
            <div class="mdl-layout-spacer"></div>
            <nav class="mdl-navigation mdl-layout--large-screen-only">
                
                    
                    
                    
                    
                         <a class="mdl-navigation__link highlight-button Setup Guide Demo-menuitem" href="/wildfly-elytron/guides/">Setup Guide Demo</a>
                    
                
                    
                    
                    
                    
                         <a class="mdl-navigation__link Home-menuitem" href="/wildfly-elytron/">Home</a>
                    
                
                    
                    
                    
                    
                         <a class="mdl-navigation__link Guides-menuitem" href="/wildfly-elytron/guides/">Guides</a>
                    
                
                    
                    
                    
                    
                         <a class="mdl-navigation__link Docs-menuitem" href="/docs/">Docs</a>
                    
                
                    
                    
                    
                    
                         <a class="mdl-navigation__link Community-menuitem" href="/wildfly-elytron/community/">Community</a>
                    
                
                    
                    
                    
                    
                         <a class="mdl-navigation__link mdl-navigation__link--current Blog-menuitem" href="/wildfly-elytron/blog/">Blog</a>
                    
                
                    
                    
                    
                    
                         <a class="mdl-navigation__link GitHub-menuitem" href="https://github.com/wildfly-security/wildfly-elytron">GitHub</a>
                    
                
            </nav>
        </div>
    </header>
    <div class="mdl-layout__drawer">
        <div class="side-drawer-logo-container"><h3>Wild<strong>Fly</strong>  Elytron</h3></div>
        <nav class="mdl-navigation">
            
            
            
            
            
                <a class="mdl-navigation__link highlight-sidebar Setup Guide Demo-menuitem" href="/wildfly-elytron/guides/">Setup Guide Demo</a>
            
            
            
            
            
            
                <a class="mdl-navigation__link Home-menuitem" href="/wildfly-elytron/">Home</a>
            
            
            
            
            
            
                <a class="mdl-navigation__link Guides-menuitem" href="/wildfly-elytron/guides/">Guides</a>
            
            
            
            
            
            
                <a class="mdl-navigation__link Docs-menuitem" href="/docs/">Docs</a>
            
            
            
            
            
            
                <a class="mdl-navigation__link Community-menuitem" href="/wildfly-elytron/community/">Community</a>
            
            
            
            
            
            
                <a class="mdl-navigation__link mdl-navigation__link--current Blog-menuitem" href="/wildfly-elytron/blog/">Blog</a>
            
            
            
            
            
            
                <a class="mdl-navigation__link GitHub-menuitem" href="https://github.com/wildfly-security/wildfly-elytron">GitHub</a>
            
            
            <!-- mdl-navigation__link--current -->
        </nav>
    </div>
    <main class="mdl-layout__content">
        <div class="page-content">
            
            <div class="content">
                <div class="post-page grid-wrapper">
  <div class="grid__item width-12-12 width-12-12-m doc-content">
    <h1>Encrypting Pre-Existing Filesystem realms</h1>
    <div class="grid-wrapper">
      <div class="grid__item width-8-12 width-12-12-m byline-wrapper">
        
        
          <img class="headshot" src="https://www.gravatar.com/avatar/9fa88b105a019dccd6ab8db410e67123">
        
        <p class="byline">
          By <a href="https://github.com/ashpan">Ashpan Raskar</a> | April 19, 2022
          <br>
          
            
              <a style="font-size: 0.9em;" href="/wildfly-elytron/blog/tag/filesystem-realm"> #filesystem-realm</a>
            
              <a style="font-size: 0.9em;" href="/wildfly-elytron/blog/tag/encryption"> #encryption</a>
            
              <a style="font-size: 0.9em;" href="/wildfly-elytron/blog/tag/tool"> #tool</a>
            
          
        </p>
      </div>
      
      <div class="grid__item width-4-12 width-12-12-m"><div class="share-page">
  <a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https://wildfly-security.github.io/wildfly-elytron/blog/filesystem-encryption-tool/&title=Encrypting Pre-Existing Filesystem realms" rel="nofollow" target="_blank" title="Share on LinkedIn">
    <i class="fab fa-linkedin"></i>
  </a>
  <a class="share-twitter" href="https://twitter.com/intent/tweet?text=Encrypting Pre-Existing Filesystem realms&url=https://wildfly-security.github.io/wildfly-elytron/blog/filesystem-encryption-tool/&via=WildFlyAS&related=WildFlyAS" rel="nofollow" target="_blank" title="Share on Twitter">
    <i class="fab fa-twitter-square"></i>
  </a>
  <a class="share-facebook" href="https://facebook.com/sharer.php?u=https://wildfly-security.github.io/wildfly-elytron/blog/filesystem-encryption-tool/" rel="nofollow" target="_blank" title="Share on Facebook">
    <i class="fab fa-facebook-square"></i>
  </a>
  <a class="share-reddit" href="http://www.reddit.com/submit?url=https://wildfly-security.github.io/wildfly-elytron/blog/filesystem-encryption-tool/" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;" title="Share on Reddit" >
    <i class="fab fa-reddit-square"></i>
  </a>
  <a class="share-email" href="mailto:?subject=Encrypting Pre-Existing Filesystem realms&amp;body=Encrypting Pre-Existing Filesystem realms https://wildfly-security.github.io/wildfly-elytron/blog/filesystem-encryption-tool/" title="Share via Email" >
    <i class="fas fa-envelope-square"></i>
  </a>
</div>
</div>
      <div class="grid__item width-12-12">
          <div class="sect1">
<h2 id="overview"><a class="anchor" href="#overview"></a>Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With the addition of the filesystem realm encryption feature <strong><a href="https://wildfly-security.github.io/wildfly-elytron/blog/filesystem-encryption/">outlined here</a></strong>, a feature was added to the Elytron Tool to encrypt a pre-existing filesystem realm.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="method-to-run-the-tool"><a class="anchor" href="#method-to-run-the-tool"></a>Method to run the tool</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are two methods to run the tool, one is on the command line, that only lets you apply encryption to one filesystem realm at a time, and the other way is to use a descriptor file which allows you to convert multiple filesystem realms at the same time.</p>
</div>
<div class="paragraph">
<p>Regardless of the method you choose, there are certain options that only work on the command line outlined below</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>--help</code>: Get help with usage of this command</p>
</li>
<li>
<p><code>--debug</code>: Print stack trace when error occurs.</p>
</li>
<li>
<p><code>--silent</code>: Suppresses all output except errors and prompts.</p>
</li>
<li>
<p><code>--summary</code>: Provides a detailed summary of all operations performed, once the command finishes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The example command would be run like the following</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ WILDFLY_HOME/bin/elytron-tool.sh filesystem-encrypt --help</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In the following post, replace <code>WILDFLY_HOME</code> with the actual path to your WildFly installation.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following options are required for both methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>--input-location</code>: The absolute or relative location of the original filesystem realm.</p>
</li>
<li>
<p><code>--output-location</code>: The directory where the new filesystem realm resides.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following options are optional for both methods, and have their defaults listed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>--realm-name</code>: The name of the new filesystem-realm (default: <code>encrypted-filesystem-realm</code>).</p>
</li>
<li>
<p><code>--credential-store</code>: The relative or absolute path to the credential store file that contains the secret key (default: <code>OUTPUT_LOCATION/mycredstore.cs</code>).</p>
</li>
<li>
<p><code>--secret-key</code>: The alias of the secret key stored in the credential store file (default: <code>key</code>).</p>
</li>
<li>
<p><code>--hash-encoding</code>: The hash encoding used in the original filesystem realm (default: <code>BASE64</code>).</p>
</li>
<li>
<p><code>--hash-charset</code>: The hash charset used in the original filesystem realm (default: <code>UTF-8</code>).</p>
</li>
<li>
<p><code>--encoded</code>: If the original realm has encoded set to true (default: <code>true</code>).</p>
</li>
<li>
<p><code>--levels</code>: The levels used in the original filesystem realm (default: <code>2</code>).</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="command-line"><a class="anchor" href="#command-line"></a>Command Line</h3>
<div class="paragraph">
<p>To run in command line mode, specify the 2 mandatory options, and any optional ones applicable to your use case. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ WILDFLY_HOME/bin/elytron-tool.sh filesystem-encrypt --input-location fs-unencrypted-realm --output-location fs-encrypted-realm --realm-name new-realm --encoded false --levels 4 --hash-encoding HEX</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command will encrypt a filesystem</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Located at <code>./fs-unencrypted-realm</code></p>
</li>
<li>
<p>Encrypted to <code>./fs-encrypted-realm/new-realm</code></p>
</li>
<li>
<p><code>encoded</code> in the original realm set to <code>false</code></p>
</li>
<li>
<p><code>levels</code> in the original realm set to <code>4</code></p>
</li>
<li>
<p><code>hash-encoding</code> used in the orignal realm set to <code>HEX</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="bulk-convert"><a class="anchor" href="#bulk-convert"></a>Bulk Convert</h3>
<div class="paragraph">
<p>A descriptor file will allow you to convert multiple realms all at once from unencrypted to encrypted filesystem realms.
To do this you will create a file in a specific format. Enter all the filesystem-encrypt options on a line with a <code>:</code> after with the value you want to set it to. To seperate realms, leave a blank line between the blocks.
For example, if you wanted to encrypt 4 realms, the below file could be created. Here it shows setting different levels, hash-charsets, and hash-encodings in the realms.</p>
</div>
<div class="paragraph">
<p>This filename is <code>bulk-encryption-conversion-desc</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">input-location:target/test-classes/filesystem-encrypt/fs-unencrypted-realms/multiple-credential-types
output-location:target/test-classes/filesystem-encrypt/fs-encrypted-realms
realm-name:multiple-credential-types
levels:1

input-location:target/test-classes/filesystem-encrypt/fs-unencrypted-realms/level-4
output-location:target/test-classes/filesystem-encrypt/fs-encrypted-realms
realm-name:level-4
levels:4

input-location:target/test-classes/filesystem-encrypt/fs-unencrypted-realms/hashcharset
output-location:target/test-classes/filesystem-encrypt/fs-encrypted-realms
realm-name:hash-charset
hash-charset:KOI8-R

input-location:target/test-classes/filesystem-encrypt/fs-unencrypted-realms/hashencoding
output-location:target/test-classes/filesystem-encrypt/fs-encrypted-realms
realm-name:hash-encoding
hash-encoding:hex</code></pre>
</div>
</div>
<div class="paragraph">
<p>To make use of this descriptor file, the following command would be run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ WILDFLY_HOME/bin/elytron-tool.sh filesystem-encrypt --bulk-convert ./bulk-encryption-conversion-desc</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="summary"><a class="anchor" href="#summary"></a>Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This blog post has given an overview on how to encrypt a filesystem realm that was previously configured without encryption for both command line mode and bulk convert mode.</p>
</div>
</div>
</div>
      </div>
    </div>
  </div>
</div>

            </div>
        </div>
    </main>
</div>
</body>
</html>
